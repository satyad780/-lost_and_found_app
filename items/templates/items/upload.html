<div class="form-group">
    <label>Mark Location (Drag the pin to exact spot)</label>
    <div id="map" style="height: 350px; border-radius: 8px; border: 1px solid var(--border);"></div>
    
    <input type="hidden" id="lat" name="latitude" value="23.2599">
    <input type="hidden" id="lng" name="longitude" value="77.4126">
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // 1. Initialize map (Default center)
    const defaultLat = 23.2599;
    const defaultLng = 77.4126;
    
    const map = L.map('map').setView([defaultLat, defaultLng], 13);

    // 2. Use a Dark Theme for the map to match your UI
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // 3. Create the DRAGGABLE marker
    let marker = L.marker([defaultLat, defaultLng], {
        draggable: true,
        autoPan: true
    }).addTo(map);

    // 4. Function to update hidden inputs
    function updateInputs(lat, lng) {
        document.getElementById('lat').value = lat.toFixed(6);
        document.getElementById('lng').value = lng.toFixed(6);
        console.log(`Location updated: ${lat}, ${lng}`); // For debugging
    }

    // 5. Update inputs when dragging ends
    marker.on('dragend', function (e) {
        const position = marker.getLatLng();
        updateInputs(position.lat, position.lng);
    });

    // 6. Update inputs if the user clicks anywhere else on the map
    map.on('click', function (e) {
        marker.setLatLng(e.latlng);
        updateInputs(e.latlng.lat, e.latlng.lng);
    });

    // 7. Optional: Try to center map on user's current location once at start
    // But still allow them to drag the pin away from there.
    if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition((position) => {
            const userLat = position.coords.latitude;
            const userLng = position.coords.longitude;
            map.setView([userLat, userLng], 15);
            marker.setLatLng([userLat, userLng]);
            updateInputs(userLat, userLng);
        });
    }
</script>